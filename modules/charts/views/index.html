<!DOCTYPE html>
<html style="height: 100%">
<head>
	<meta charset="utf-8">
	<title>{{ title }}</title>
</head>
<body style="height: 100%; margin: 0">

<input  value="{{content}}" onclick="download('img1')" id="inputV">
<div id="container" style="height: 50%"></div>
<div id="container2" style="height: 50%"></div>
<script  src="https://lib.baomitu.com/echarts/4.9.0-rc.1/echarts.js"  type="text/javascript"></script>

<script type="text/javascript">
	var dom = document.getElementById("container");
	var myChart = echarts.init(dom);
	var dom2 = document.getElementById("container2");
	var myChart2 = echarts.init(dom2);
	const input = document.getElementById('inputV')
	const {op1,op2} = JSON.parse(input.value)
	console.log(op1);
	console.log(typeof op1)
	if (op1 && typeof op2 === "object") {
		setTimeout(()=>{
			myChart.setOption(op1, true);
			myChart2.setOption(op2, true);
			const url = myChart.getDataURL()
			downloadImage(url,'charts1')
			const url2= myChart2.getDataURL()
			downloadImage(url2,'charts2')
		},1000)
	}
	function downloadImage(path, imgName) {
		var _OBJECT_URL;
		var request = new XMLHttpRequest();
		request.addEventListener('readystatechange', function (e) {
			if (request.readyState == 4) {
				_OBJECT_URL = URL.createObjectURL(request.response);
				// var $a = $("<a></a>").attr("href", _OBJECT_URL).attr("download", imgName);
				// $a[0].click();
				let aLink = document.createElement('a');
				aLink.href = _OBJECT_URL;
				let evt = document.createEvent("HTMLEvents");
				evt.initEvent("click", true, true);
				aLink.download = imgName;
				aLink.click()
			}
		});
		request.responseType = 'blob';
		request.open('get', path);
		request.send();
	}
</script>
</body>
</html>